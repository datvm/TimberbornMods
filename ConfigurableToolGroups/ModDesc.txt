[b]TLDR: Subscribe to [url=https://steamcommunity.com/sharedfiles/filedetails/?id=3293437485]More Groups[/url] and this mod. Tutorial is disabled.[/b]

Moddable Tool Groups gives full control over how tool groups are structured. It lets mods create multi-level tool groups, put the same tool/group in multiple places, and freely reorganize the tool hierarchy.

[b]Note to players:[/b]
- For some funny reason, Tutorial will not work with this mod enabled. Just enable this mod once you have finished the Tutorial.
- This mod does nothing on its own. It only provides a framework that other mods can use to add multi-level tool groups. [b]You can pick any flavor from those mods like [url=https://steamcommunity.com/sharedfiles/filedetails/?id=3293437485]More Groups[/url][/b] or my own [url=https://steamcommunity.com/sharedfiles/filedetails/?id=3612247861]More Organized Tool Groups mod[/url].

For modders: see the [url=https://steamcommunity.com/sharedfiles/filedetails/?id=3612247861]More Organized Tool Groups mod[/url] for examples.

[b]Notes:[/b]
- Subgroups always appear before Tools, each kind is still sorted by their own Order (BlockObjectToolGroupSpec.Order between themselves and PlaceableBlockObject.Order between themselves).

This mod provides two specs: [b]ParentToolGroupSpec[/b] and [b]ToolGroupChildrenSpec[/b]:

[code]
public record ParentToolGroupSpec : ComponentSpec
{
	[Serialize]
	public ImmutableArray<string> ParentIds { get; init; } = [];
}

public record ToolGroupChildrenSpec : ComponentSpec
{
	[Serialize]
	public ImmutableArray<string> ChildrenGroupsIds { get; init; } = [];

	[Serialize]
	public ImmutableArray<string> ChildrenToolsTemplateNames { get; init; } = [];

    [Serialize] // Added in v10.0.4
    public ImmutableArray<string> ChildrenOrderedIds { get; init; } = [];

	[Serialize]
	public bool DoNotIncludePlaceableToolGroup { get; init; }
}
[/code]

[b]ParentToolGroupSpec[/b] can be applied to [b]BlockObjectToolGroupSpec[/b] or any block object blueprints. [b]ToolGroupChildrenSpec[/b] quickly populates a tool group with child groups and tools. Both can be combined. Duplicates are removed automatically, and cyclic groups are detected with clear error info.

[b]ChildrenOrderedIds[/b] can be used to specify the exact order of children (both groups and tools) in a mixed group. If specified, it overrides the default ordering by bringing any declared ids to the front in the given order, followed by any remaining children sorted the previous values.

[h1]Examples:[/h1]

Combine the Food and Water tool groups into a new group called Essentials in [b]Essentials.BlockObjectToolGroupSpec.blueprint.json[/b]:

[code]
{
    "BlockObjectToolGroupSpec": {
        "Id": "Essentials",
        "Order": 45,
        "NameLocKey": "LV.OG.GroupEssentials",
        "Icon": "Sprites/OrganizedGroups/Essentials",
        "FallbackGroup": false
    },
    "ToolGroupChildrenSpec": {
        "ChildrenGroupsIds": [
            "Food",
            "Water"
        ]
    }
}
[/code]

Alternatively, you can just declare the group and move items in with [b]ParentToolGroupSpec[/b]. In [b]Productions.BlockObjectToolGroupSpec.blueprint[/b], only the group is declared, and [b]BlockObjectToolGroup.Metal.blueprint.json[/b] and [b]BlockObjectToolGroup.Wood.blueprint.json[/b] move the groups into Productions:

[code]
{
    "ParentToolGroupSpec": {
        "ParentIds": [ "Productions" ]
    }
}
[/code]

[b]ParentToolGroupSpec[/b] can be applied to block object blueprints too. In [b]Platform.Folktails.blueprint.json[/b] and [b]Platform.IronTeeth.blueprint.json[/b], I add the platforms to "Path" because I think it's often used:

[code]
{
    "ParentToolGroupSpec": {
        "ParentIds": [ "Paths" ]
    }
}
[/code]

But aren't they already in "Paths" group? Well, because I also make a "Platforms" group and in its [b]ToolGroupChildrenSpec[/b], I declare the [b]Platform[/b] and with [b]DoNotIncludePlaceableToolGroup: true[/b] (so Double and Triple platforms do not appear in Paths again):

Platforms.BlockObjectToolGroupSpec.blueprint.json:
[code]
{
    "BlockObjectToolGroupSpec": {
        "Id": "Platforms",
        "Order": 10,
        "NameLocKey": "LV.OG.GroupPlatforms",
        "Icon": "Sprites/OrganizedGroups/Platforms",
        "FallbackGroup": false
    },
    "ToolGroupChildrenSpec": {
        "ChildrenToolsTemplateNames": [
            "Platform.Folktails",
            "Platform.IronTeeth",
            "DoublePlatform.Folktails",
            "DoublePlatform.IronTeeth",
            "TriplePlatform.Folktails",
            "TriplePlatform.IronTeeth"
        ],
        "DoNotIncludePlaceableToolGroup": true
    }
}
[/code]

So with the above files, Platform appears twice: once in Platforms group and once in Paths group.

The most complete example is the Surfaces group: it is inside the Paths group and it contains both many tool groups (Platforms, Bridges and Overhangs) and many tools (Metal Platform 3x3 and 5x5):

[code]
{
    "BlockObjectToolGroupSpec": {
        "Id": "Surfaces",
        "Order": 10,
        "NameLocKey": "LV.OG.GroupSurfaces",
        "Icon": "Sprites/OrganizedGroups/Surfaces",
        "FallbackGroup": false
    },
    "ParentToolGroupSpec": {
        "ParentIds": [ "Paths" ]
    },
    "ToolGroupChildrenSpec": {
        "ChildrenGroupsIds": [
            "Platforms",
            "Bridges",
            "Overhangs"
        ],
        "ChildrenToolsTemplateNames": [
            "MetalPlatform3x3.Folktails",
            "MetalPlatform3x3.IronTeeth",
            "MetalPlatform5x5.Folktails",
            "MetalPlatform5x5.IronTeeth"
        ],
        "DoNotIncludePlaceableToolGroup": true
    }
}
[/code]

[h2]Using ChildrenOrderedIds to order both groups and tools[/h2]

The following file (not in the demo) shows how to use [b]ChildrenOrderedIds[/b] to order both groups and tools in a mixed group:

[b]Blueprints\blockobjecttoolgroups\BlockObjectToolGroup.Paths.blueprint.json[/b]

[code]
{
    "ToolGroupChildrenSpec": {
        "ChildrenToolsTemplateNames": [
            "Platform.Folktails",
            "Platform.IronTeeth"
        ],
        "ChildrenOrderedIds": [
            "Subgroup_MGZiplines",
            "Path",
            "Subgroup_MGMetalPlatform"
        ]
    }
}
[/code]

The above code snippet will add the Platform tool into the Paths group, and the order of children in Paths group will be: Zipline subgroup, Path tool, Metal Platform subgroup, and then any other existing children sorted by their Order values (with Subgroups first).

If you need any help, feel free to ask on Discord ([url=https://discord.com/channels/558398674389172225/888491376143134760]#mod-creators[/url] or [url=https://discord.com/channels/558398674389172225/1064825134348763209/threads/1442833036646420580]Moddable Tool Groups channel[/url])

===
Mod source code and donation: https://github.com/datvm/TimberbornMods (feel free to use the code for anything).

v10.0.4:
- Added support for [b]ChildrenOrderedIds[/b] for ordering children in mixed groups (both subgroups and tools).
- Fixed description panels showing way too low behind the tool buttons.
v10.0.3: Fixed a crash when there are multiple copies of a tool.
v10.0.2: Fixed the tooltip sometimes saying "Tooltip" instead of the group name.
v10.0.1: Fixed a crash when a group is present at multiple places. Unfortunately I have to patch out Tutorial to fix it so just play it without Tutorial 😂.